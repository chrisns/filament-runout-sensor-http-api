# Claude Code Context: MCP2221A Filament Sensor Monitor

## Repository
GitHub: https://github.com/chrisns/filament-runout-sensor-http-api

## Project Overview
Python-based Windows application monitoring dual BIGTREETECH filament sensors via MCP2221A USB-GPIO adapter with real-time terminal display and HTTP API.

## Current Feature
**Branch**: 001-mcp2221a-filament-sensor
**Status**: Planning Phase Complete
**Next Step**: Execute /tasks command to generate implementation tasks

## Technology Stack
- **Python 3.11** - Core language
- **EasyMCP2221** - USB-GPIO hardware interface
- **FastAPI** - HTTP server (port 5002)
- **Textual** - Terminal UI with split-screen
- **SQLite** - In-memory session storage
- **Pydantic** - Configuration validation

## Project Structure
```
src/
├── models/         # Data models (sensor_reading, configuration)
├── services/       # Core services (mcp2221_manager, sensor_monitor)
├── cli/           # Command-line interface
└── lib/           # Feature libraries
    ├── mcp2221_sensor/   # Hardware interface
    ├── display/          # Terminal UI
    ├── api_server/       # HTTP endpoints
    └── config/          # Configuration management

tests/
├── contract/      # API contract tests
├── integration/   # Hardware integration tests
└── unit/         # Component tests
```

## Key Requirements
- Monitor 2 sensors simultaneously
- Detect filament presence/movement
- Track usage (2.88mm per pulse default)
- 100ms polling interval (configurable)
- Terminal display with split view
- JSON API on port 5002
- Session-only data retention

## Hardware Configuration
```
MCP2221A GPIO Mapping:
- GP0: Sensor 1 Movement
- GP1: Sensor 1 Runout
- GP2: Sensor 2 Movement
- GP3: Sensor 2 Runout
```

## Development Guidelines
1. **TDD Required**: Write tests first (RED-GREEN-Refactor)
2. **No Abstractions**: Use frameworks directly
3. **Library-First**: Each feature as standalone library
4. **CLI Interface**: Every library must have CLI
5. **Structured Logging**: Use structlog throughout

## Testing Strategy
- Contract tests for API endpoints
- Integration tests with real hardware
- Unit tests for calculations
- End-to-end validation scenarios

## Recent Changes
- [2025-09-15] Initial specification created
- [2025-09-15] Research phase completed
- [2025-09-15] Data model and API contracts defined

## Commands
```bash
# Test hardware connection
python -m mcp2221_sensor --test-connection

# Run application
python main.py

# Run with debug
python main.py --debug

# Export config
python main.py --export-config
```

## Performance Targets
- Polling: 10ms hardware, 100ms configurable
- UI Updates: <10ms latency
- API Response: <5ms
- Memory: <50MB for 24-hour session

## Known Constraints
- Windows 10/11 only (USB HID driver)
- 4 GPIO pins maximum per MCP2221A
- Session data only (no persistence)
- Single user local application

---
*Auto-generated by /plan command - Manual additions below this line preserved*